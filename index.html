<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; }
        /* 相機層：直接強制置底 */
        #video {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            object-fit: cover; z-index: 1;
        }
        /* 零件層：浮在相機上面 */
        #part-layer {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: 10; pointer-events: none; /* 讓點擊穿透到背景觸發移動 */
        }
        #part1 {
            position: absolute; width: 150px; opacity: 0.7; /* 半透明方便對位 */
            transform: translate(-50%, -50%);
        }
        #ui {
            position: fixed; top: 10px; left: 10px; z-index: 100;
            background: rgba(0,0,0,0.8); color: #0f0; padding: 10px; border: 1px solid #0f0;
        }
        #controls { position: fixed; bottom: 20px; width: 100%; text-align: center; z-index: 100; }
        button { padding: 15px 30px; background: #0f0; border: none; border-radius: 10px; font-weight: bold; }
    </style>
</head>
<body>

    <video id="video" autoplay playsinline></video>
    
    <div id="part-layer">
        <img id="part1" src="part1.png" style="left: 50%; top: 50%;">
    </div>

    <div id="ui">
        座標採集器 (手動模式)<br>
        1. 請對準實體圖<br>
        2. 滑動螢幕移動零件<br>
        X: <span id="valX">0.00</span> | Y: <span id="valY">0.00</span>
    </div>

    <div id="controls">
        <button onclick="requestCamera()">開啟鏡頭</button>
    </div>

    <script>
        const video = document.getElementById('video');
        const part = document.getElementById('part1');
        const valX = document.getElementById('valX');
        const valY = document.getElementById('valY');

        // 1. 強制啟動鏡頭
        async function requestCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "environment" } 
                });
                video.srcObject = stream;
                document.getElementById('controls').style.display = 'none';
            } catch (err) {
                alert("無法開啟鏡 le: " + err.message);
            }
        }

        // 2. 觸控移動零件並計算座標
        window.addEventListener('touchmove', (e) => {
            let touch = e.touches[0];
            part.style.left = touch.clientX + 'px';
            part.style.top = touch.clientY + 'px';

            // 換算成我們 AR 程式需要的數學座標
            let x = ((touch.clientX / window.innerWidth) * 2 - 1) * 1.5;
            let y = (-(touch.clientY / window.innerHeight) * 2 + 1) * 1.5;
            
            valX.innerText = x.toFixed(2);
            valY.innerText = y.toFixed(2);
        });
    </script>
</body>
</html>