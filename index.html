<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <style>
    body { margin: 0; overflow: hidden; background: #222; color: white; font-family: sans-serif; }
    #status { position: fixed; top: 0; left: 0; width: 100%; background: rgba(0,0,0,0.8); padding: 20px; z-index: 10000; word-break: break-all; }
    button { padding: 15px 30px; background: #00FF00; border: none; font-size: 18px; margin-top: 10px; border-radius: 8px; }
  </style>
</head>
<body>

  <div id="status">
    <div>系統狀態：正在準備...</div>
    <button onclick="manualStart()">點此強制啟動相機</button>
  </div>

  <a-scene 
    mindar-image="imageTargetSrc: targets.mind; autoStart: false; uiLoading: no;" 
    embedded vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
    
    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
    <a-entity mindar-image-target="targetIndex: 0">
        <a-sphere position="0 0 0" radius="0.05" color="red"></a-sphere>
        <a-image src="part1.png" position="0 0 0.1" scale="0.5 0.5 0.5"></a-image>
    </a-entity>
  </a-scene>

  <script>
    const statusDiv = document.getElementById('status');

    function log(msg, color = "white") {
      const div = document.createElement('div');
      div.style.color = color;
      div.innerText = "> " + msg;
      statusDiv.appendChild(div);
    }

    // 監聽所有錯誤
    window.onerror = function(msg, url, line) {
      log("錯誤: " + msg, "red");
    };

    async function manualStart() {
      log("嘗試啟動相機與 AR...");
      
      const sceneEl = document.querySelector('a-scene');
      const arSystem = sceneEl.systems["mindar-image-system"];
      
      try {
        // 先檢查 targets.mind 是否存在
        const response = await fetch('targets.mind');
        if (response.ok) {
          log("成功讀取 targets.mind 檔案", "cyan");
        } else {
          log("錯誤：找不到 targets.mind (404)，請確認檔名是否全小寫且在根目錄", "red");
          return;
        }

        // 啟動 AR
        await arSystem.start();
        log("AR 系統已啟動，請觀察是否出現相機畫面", "green");
      } catch (e) {
        log("啟動失敗: " + e.message, "red");
      }
    }
  </script>
</body>
</html>