<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; }
        /* 強制讓 A-Frame 的畫布透明，露出底層相機 */
        canvas { opacity: 1 !important; }
        #ui {
            position: fixed; top: 10px; left: 10px; z-index: 1000;
            background: rgba(0,0,0,0.8); color: #0f0; padding: 10px;
            font-family: monospace; border: 1px solid #0f0;
        }
        #btn-layer {
            position: fixed; bottom: 20%; left: 0; width: 100%;
            display: flex; justify-content: center; z-index: 2000;
        }
        button {
            padding: 15px 30px; font-size: 18px; background: #00FF00;
            border: none; border-radius: 10px; font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="ui">X: <span id="valX">0.00</span> | Y: <span id="valY">0.00</span></div>

    <div id="btn-layer">
        <button id="start">1. 點擊開啟相機</button>
    </div>

    <a-scene 
        mindar-image="imageTargetSrc: targets.mind; autoStart: false; uiLoading: no; uiScanning: yes;" 
        embedded vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false"
        renderer="preserveDrawingBuffer: true; alpha: true;">
        
        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <a-entity mindar-image-target="targetIndex: 0">
            <a-sphere position="0 0 0" radius="0.05" color="red"></a-sphere>
            
            <a-image id="part1" src="part1.png" position="0 0 0.1" scale="0.5 0.5 0.5"></a-image>
            
            <a-image src="MissingPartScene.png" position="0 0 0" opacity="0.3"></a-image>
        </a-entity>
    </a-scene>

    <script>
        const btn = document.getElementById('start');
        const sceneEl = document.querySelector('a-scene');

        btn.onclick = () => {
            btn.style.display = 'none';
            // 手動呼叫 AR 系統啟動
            const arSystem = sceneEl.systems["mindar-image-system"];
            arSystem.start();
            
            // 強制修正：有些三星手機需要點擊後重新調整畫布大小才會出圖
            setTimeout(() => {
                window.dispatchEvent(new Event('resize'));
            }, 1000);
        };

        window.addEventListener('touchmove', (e) => {
            let touch = e.touches[0];
            let x = ((touch.clientX / window.innerWidth) * 2 - 1) * 1.5;
            let y = (-(touch.clientY / window.innerHeight) * 2 + 1) * 1.5;
            
            document.getElementById('part1').setAttribute('position', `${x.toFixed(2)} ${y.toFixed(2)} 0.1`);
            document.getElementById('valX').innerText = x.toFixed(2);
            document.getElementById('valY').innerText = y.toFixed(2);
        });
    </script>
</body>
</html>